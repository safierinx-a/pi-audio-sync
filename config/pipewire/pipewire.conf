# PipeWire configuration for Pi Audio Sync
context.properties = {
    # Core
    core.daemon = true
    core.name = pipewire-0

    # Processing
    default.clock.rate = 48000
    default.clock.quantum = 1024
    default.clock.min-quantum = 32
    default.clock.max-quantum = 8192
}

context.spa-libs = {
    audio.convert.* = audioconvert/libspa-audioconvert
    api.alsa.* = alsa/libspa-alsa
    api.v4l2.* = v4l2/libspa-v4l2
    api.bluez5.* = bluez5/libspa-bluez5
}

context.modules = [
    # Core
    { name = libpipewire-module-protocol-native }
    { name = libpipewire-module-metadata }
    { name = libpipewire-module-spa-device-factory }
    { name = libpipewire-module-spa-node-factory }
    { name = libpipewire-module-client-node }
    { name = libpipewire-module-client-device }
    
    # Audio Processing
    { 
        name = libpipewire-module-filter-chain
        args = {
            node.description = "Stereo Balance"
            media.name = "Stereo Balance"
            filter.graph = {
                nodes = [
                    {
                        type = builtin
                        name = mixer
                        label = mixer
                        control = { 
                            volumes = 1.0
                            mute = 0
                            bypass = 1
                        }
                    }
                ]
            }
            audio.channels = 2
            audio.position = [ FL FR ]
            capture.props = {
                node.name = "effect_input.stereo_balance"
                node.passive = true
                media.class = Audio/Sink
                audio.channels = 2
                audio.position = [ FL FR ]
            }
            playback.props = {
                node.name = "effect_output.stereo_balance"
                node.passive = true
                media.class = Audio/Source
                audio.channels = 2
                audio.position = [ FL FR ]
            }
        }
    }
    
    # Audio
    { name = libpipewire-module-adapter }
    { name = libpipewire-module-rt }
    
    # Session Manager
    { name = libpipewire-module-session-manager }
]

stream.properties = {
    node.latency = 1024/48000
    resample.quality = 4
}

alsa.properties = {
    alsa.buffer-size = 4096
    alsa.period-size = 1024
    alsa.period-num = 4
}

bluez5.properties = {
    bluez5.enable-sbc-xq = true
    bluez5.enable-msbc = true
    bluez5.enable-hw-volume = true
    bluez5.headset-roles = [ hsp_hs hsp_ag hfp_hf hfp_ag a2dp_sink ]
    bluez5.codecs = [ sbc_xq sbc aac ]
    bluez5.hfphsp-backend = native
    bluez5.msbc-support = true
    bluez5.msbc-force-mtu = 0
    bluez5.keep-profile = true
    bluez5.a2dp.ldac.quality = auto
    bluez5.a2dp.aac.bitratemode = 0
    bluez5.a2dp.aac.quality = 1
} 

# PipeWire-Pulse configuration
"/usr/bin/pipewire-pulse" = { 
    "args" = "-a tcp:4713"
    "exec" = true
} 